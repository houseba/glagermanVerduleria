<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="bd_pos_glagerman.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="0"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="3118"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="Categoria" custom_title="0" dock_id="1" table="4,9:mainCategoria"/><dock_state state="000000ff00000000fd0000000100000002000005bb0000038efc0100000001fb000000160064006f0063006b00420072006f00770073006500310100000000000005bb0000011900ffffff000002590000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="Ajuste_Inventario" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="60"/><column index="2" value="86"/><column index="3" value="111"/><column index="4" value="80"/><column index="5" value="88"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Categoria" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="78"/><column index="2" value="110"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="sqlite_sequence" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="39"/><column index="2" value="29"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1*">PRAGMA foreign_keys = ON;

-- =========================
--  Tablas maestras
-- =========================
CREATE TABLE Proveedor (
  rut_proveedor        TEXT PRIMARY KEY,
  nombre_proveedor     TEXT NOT NULL,
  direccion_proveedor  TEXT,
  contacto_proveedor   TEXT
);

CREATE TABLE Categoria (
  id_categoria     INTEGER PRIMARY KEY AUTOINCREMENT,
  nombre_categoria TEXT NOT NULL UNIQUE
);

CREATE TABLE Producto (
  cod_producto           TEXT PRIMARY KEY,                  -- EAN/SKU
  nombre_producto        TEXT NOT NULL,
  precio_unitario_venta  INTEGER NOT NULL CHECK (precio_unitario_venta &gt;= 0),
  unidad_medida          TEXT NOT NULL,                     -- kg, un, pack, L, etc.
  stock_actual           INTEGER NOT NULL DEFAULT 0 CHECK (stock_actual &gt;= 0),
  stock_minimo           INTEGER NOT NULL DEFAULT 0 CHECK (stock_minimo &gt;= 0),
  id_categoria           INTEGER,
  FOREIGN KEY (id_categoria)
    REFERENCES Categoria(id_categoria)
    ON UPDATE CASCADE
    ON DELETE SET NULL
);

-- =========================
--  Compras
-- =========================
CREATE TABLE Compra (
  id_compra      INTEGER PRIMARY KEY AUTOINCREMENT,
  total_compra   INTEGER NOT NULL DEFAULT 0 CHECK (total_compra &gt;= 0),
  fecha_compra   TEXT NOT NULL,                              -- ISO-8601
  rut_proveedor  TEXT NOT NULL,
  FOREIGN KEY (rut_proveedor)
    REFERENCES Proveedor(rut_proveedor)
    ON UPDATE CASCADE
    ON DELETE RESTRICT
);

CREATE TABLE Detalle_Compra (
  id_detalle_compra       INTEGER PRIMARY KEY AUTOINCREMENT,
  id_compra               INTEGER NOT NULL,
  cod_producto            TEXT    NOT NULL,
  cantidad_compra         INTEGER NOT NULL CHECK (cantidad_compra &gt; 0),
  precio_unitario_compra  INTEGER NOT NULL CHECK (precio_unitario_compra &gt;= 0),
  FOREIGN KEY (id_compra)
    REFERENCES Compra(id_compra)
    ON UPDATE CASCADE
    ON DELETE CASCADE,
  FOREIGN KEY (cod_producto)
    REFERENCES Producto(cod_producto)
    ON UPDATE CASCADE
    ON DELETE RESTRICT
);

-- =========================
--  Ventas
-- =========================
CREATE TABLE Venta (
  id_venta     INTEGER PRIMARY KEY AUTOINCREMENT,
  fecha_venta  TEXT NOT NULL,                                -- ISO-8601
  total_venta  INTEGER NOT NULL CHECK (total_venta &gt;= 0)
);

CREATE TABLE Detalle_Venta (
  id_detalle_venta      INTEGER PRIMARY KEY AUTOINCREMENT,
  id_venta              INTEGER NOT NULL,
  cod_producto          TEXT    NOT NULL,
  cantidad_venta        INTEGER NOT NULL CHECK (cantidad_venta &gt; 0),
  precio_unitario_venta INTEGER NOT NULL CHECK (precio_unitario_venta &gt;= 0),
  FOREIGN KEY (id_venta)
    REFERENCES Venta(id_venta)
    ON UPDATE CASCADE
    ON DELETE CASCADE,
  FOREIGN KEY (cod_producto)
    REFERENCES Producto(cod_producto)
    ON UPDATE CASCADE
    ON DELETE RESTRICT
);

-- =========================
--  Ajustes de Inventario
-- =========================
CREATE TABLE Ajuste_Inventario (
  id_ajuste         INTEGER PRIMARY KEY AUTOINCREMENT,
  cod_producto      TEXT    NOT NULL,
  cantidad_ajustada INTEGER NOT NULL,
  fecha_ajuste      TEXT    NOT NULL,                        
  motivo_ajuste     TEXT    NOT NULL,
  FOREIGN KEY (cod_producto)
    REFERENCES Producto(cod_producto)
    ON UPDATE CASCADE
    ON DELETE RESTRICT
);

-- Convierte los nombres de tablas a min√∫sculas
ALTER TABLE Proveedor         RENAME TO proveedor;
ALTER TABLE Categoria         RENAME TO categoria;
ALTER TABLE Producto          RENAME TO producto;
ALTER TABLE Compra            RENAME TO compra;
ALTER TABLE Detalle_Compra    RENAME TO detalle_compra;
ALTER TABLE Venta             RENAME TO venta;
ALTER TABLE Detalle_Venta     RENAME TO detalle_venta;
ALTER TABLE Ajuste_Inventario RENAME TO ajuste_inventario;


</sql><current_tab id="0"/></tab_sql></sqlb_project>
